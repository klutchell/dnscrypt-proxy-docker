version: "2"

services:

  server:
    image: sut
    build:
      context: .
      dockerfile: Dockerfile
    networks:
      - internal

  sut:
    image: alpine:3.17
    networks:
      - internal
    depends_on:
      - server
    entrypoint: ""
    command: >-
      /bin/sh -c '
      apk add --no-cache bind-tools &&
      sleep 60 &&
      dig -p 5053 dnssec-tools.org @server +dnssec | tee /dev/stderr | grep -wq NOERROR &&
      dig -p 5053 dnssec-failed.org @server +dnssec | tee /dev/stderr | grep -wq SERVFAIL
      '
